{% extends 'base.html' %}
{% block content %}
<style>
.pathpilot-timeline {
  margin-top: 32px;
  border-left: 4px solid #27a3e2;
  padding-left: 24px;
}
.pathpilot-timeline .timeline-item {
  margin-bottom: 32px;
  position: relative;
}
.pathpilot-timeline .timeline-dot {
  position: absolute;
  left: -32px;
  top: 0;
  width: 20px;
  height: 20px;
  background: #ff9800;
  border-radius: 50%;
  border: 3px solid #fff;
  box-shadow: 0 0 0 4px #27a3e2;
}
.pathpilot-timeline .timeline-content {
  background: #f7fbff;
  border-radius: 8px;
  padding: 18px 24px;
  box-shadow: 0 2px 8px rgba(39,163,226,0.08);
}
.pathpilot-timeline .timeline-title {
  color: #27a3e2;
  font-weight: 700;
  font-size: 1.2rem;
}
.pathpilot-timeline .timeline-topic {
  color: #ff9800;
  font-weight: 600;
  font-size: 1.1rem;
}
</style>
<div class="container mt-4">
  <h2>{{ map.title }}</h2>
  <p class="text-muted">Created: {{ map.created_at|date:'Y-m-d H:i' }}</p>
  <hr>
  <div id="map-view" class="pathpilot-timeline">
    {% if plan and plan.items %}
      {% for key, details in plan.items %}
        {% if details.items %} {# Nested: Semester -> Steps #}
          {% for step, step_details in details.items %}
            <div class='timeline-item'>
              <div class='timeline-dot'></div>
              <div class='timeline-content'>
                <div class='timeline-title'>{{ key }} - {{ step }}</div>
                <div class='timeline-topic'>Topic: {{ step_details.Topic|default_if_none:"" }}</div>
                <div><strong>Periods:</strong> {{ step_details.Periods|default_if_none:"-" }}</div>
                <div><strong>Hints:</strong> {{ step_details.Hints|default_if_none:"-" }}</div>
                <div><strong>Resources:</strong> {{ step_details.Resources|default_if_none:"-" }}</div>
              </div>
            </div>
          {% endfor %}
        {% else %} {# Flat: Semester -> Details #}
          <div class='timeline-item'>
            <div class='timeline-dot'></div>
            <div class='timeline-content'>
              <div class='timeline-title'>{{ key }}</div>
              <div class='timeline-topic'>Topic: {{ details.Topic|default_if_none:"" }}</div>
              <div><strong>Periods:</strong> {{ details.Periods|default_if_none:"-" }}</div>
              <div><strong>Hints:</strong> {{ details.Hints|default_if_none:"-" }}</div>
              <div><strong>Resources:</strong> {{ details.Resources|default_if_none:"-" }}</div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    {% else %}
      <div class="alert alert-warning">No roadmap data or map is empty.</div>
    {% endif %}
  </div>
  <a href="{% url 'map_history' %}" class="btn btn-secondary mt-3">Back to Map History</a>
</div>
{% endblock %}

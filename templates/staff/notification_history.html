{% extends 'base.html' %}
{% load static %}

{% block mobile_header %}{% endblock %}

{% block root %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body p-0">
                    <style>
                        /* Adapted OD/leaves table style for notifications */
                        .notif-table { width:100%; margin-top:8px; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.05); border-radius:8px; overflow-x:auto; }
                        .notif-table-header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; background:#1976d2; color:#fff; font-weight:600; border-top-left-radius:8px; border-top-right-radius:8px; }
                        .notif-divider { margin:0; border:0; height:2px; background:linear-gradient(to right,#e0e7ff,#e0e0e0); }
                        .notif-header, .notif-row { display:grid; grid-template-columns: 10% 70% 20%; align-items:center; gap:8px; padding:12px 16px; border-bottom:1px solid #e8edf2; }
                        .notif-header { background:#f5f7fa; color:#2c3e50; font-weight:600; text-transform:uppercase; font-size:0.85rem; position:sticky; top:0; z-index:5; }
                        .notif-header > div, .notif-row > div { padding:4px 8px; box-sizing:border-box; min-width:0; }
                        .notif-row { transition:background-color 0.12s ease; }
                        .notif-row:nth-child(even) { background:#fbfdff; }
                        .notif-row:hover { background:#f1f5f9; }
                        .notif-id { font-weight:600; color:#1976d2; font-family:monospace; }
                        .notif-message { color:#1f2937; }
                        .notif-row.unread { background: linear-gradient(90deg, rgba(255,249,230,0.6), rgba(255,255,255,0)); }
                        .notif-row .text-muted { color:#6b7280; font-size:0.9rem; }
                        @media (max-width:768px) {
                            .notif-header, .notif-row { grid-template-columns: 1fr; text-align:left; }
                            .notif-header div { display:none; }
                            .notif-row { border:1px solid #e6eef6; margin-bottom:12px; border-radius:8px; padding:10px; }
                            .notif-row > div { display:block; padding:6px 0; }
                            .notif-row > div::before { content: attr(data-label); display:block; font-weight:600; color:#555; margin-bottom:6px; }
                            .notif-row .notif-message { white-space:normal; }
                            .notif-row .text-muted { display:block; margin-top:6px; }
                        }
                    </style>

                    <div class="notif-table">
                        <div class="notif-table-header" style="display:flex;align-items:center;">
                            <span>Staff Notification History</span>
                            <div style="display:flex;gap:8px;align-items:center;margin-left:auto;margin-right:8px;">
                                <form method="post" action="{% url 'delete_all_staff_notifications' %}" style="margin:0;">
                                    {% csrf_token %}
                                    <input type="hidden" name="delete_all" value="1">
                                    <button type="submit" class="btn btn-danger btn-sm">Delete All</button>
                                </form>
                                <form method="post" style="margin:0;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-light btn-sm">Mark all as read</button>
                                </form>
                            </div>
                            <a href="{% url 'dash' %}" class="home-icon d-block d-md-none" style="color:white;">
                                <i class="fa fa-home" aria-hidden="true" aria-label="Home"></i>
                            </a>
                        </div>
                        <hr class="notif-divider">

                        <div class="notif-header">
                            <div>ID</div>
                            <div>MESSAGE</div>
                            <div>DATE</div>
                        </div>

                        {% for n in all_notifications %}
                            <div class="notif-row {% if not n.is_read %}unread{% endif %}">
                                <div class="notif-id" data-label="ID">{% if n.id %}#N{{ n.id }}{% else %}-{% endif %}</div>
                                <div class="notif-message" data-label="MESSAGE">
                                    <i class="fa fa-info-circle text-info" aria-hidden="true"></i>
                                    {% if n.circular %}
                                        <a href="{% url 'circular_detail' n.circular.id %}">{{ n.message }}</a>
                                    {% else %}
                                        <span>{{ n.message }}</span>
                                    {% endif %}
                                </div>
                                <div class="text-muted" data-label="DATE">{{ n.created_at|date:'d M Y H:i' }}</div>
                            </div>
                        {% empty %}
                            <div class="notif-row"><div style="grid-column:1/-1;text-align:center;padding:16px;">No notifications found.</div></div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}